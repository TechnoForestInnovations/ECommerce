<!-- templates/shop/payment.html -->
<!doctype html>
<html>
<head>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Checkout</title>
</head>
<body>
  <h2>Checkout</h2>
  <p>Pay â‚¹{{ order.amount|floatformat:-2|divisibleby:100 }}</p>

  <!-- This form will POST to our success view after Razorpay checkout completes -->
  <form id="razorpay-form" method="POST" action="{{ callback_url }}">
    {% csrf_token %}
    <input type="hidden" name="order_id" value="{{ order.id }}">
    <input type="hidden" name="razorpay_payment_id" id="razorpay_payment_id">
    <input type="hidden" name="razorpay_order_id" id="razorpay_order_id" value="{{ razorpay_order_id }}">
    <input type="hidden" name="razorpay_signature" id="razorpay_signature">
  </form>

  <button id="pay-button">Pay Now</button>

  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script>
    var options = {
      "key": "{{ razorpay_key_id }}",
      "amount": "{{ amount }}", // in paise
      "currency": "{{ currency }}",
      "name": "Your Shop",
      "description": "Order #{{ order.id }}",
      "order_id": "{{ razorpay_order_id }}",
      "handler": function (response){
        // set hidden inputs and submit form to server for verification
        document.getElementById('razorpay_payment_id').value = response.razorpay_payment_id;
        document.getElementById('razorpay_order_id').value = response.razorpay_order_id;
        document.getElementById('razorpay_signature').value = response.razorpay_signature;
        document.getElementById('razorpay-form').submit();
      },
      "prefill": {
        "name": "{{ order.full_name }}",
        "email": "{{ order.email }}",
        "contact": "{{ order.phone }}"
      },
      "theme": {
        "color": "#3399cc"
      }
    };

    document.getElementById('pay-button').onclick = function(e){
      var rzp = new Razorpay(options);
      rzp.open();
      e.preventDefault();
    }
  </script>
</body>
</html>
